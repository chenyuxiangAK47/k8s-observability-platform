# ğŸ“š å¯è§‚æµ‹æ€§å¹³å°å­¦ä¹ æŒ‡å—

## ğŸ¯ å­¦ä¹ ç›®æ ‡

é€šè¿‡è¿™ä¸ªé¡¹ç›®ï¼Œä½ å°†æŒæ¡ï¼š
- **Metricsï¼ˆæŒ‡æ ‡ï¼‰**: Prometheus + Grafana
- **Logsï¼ˆæ—¥å¿—ï¼‰**: Loki + Grafana
- **Tracesï¼ˆè¿½è¸ªï¼‰**: Jaeger
- **å®Œæ•´çš„å¯è§‚æµ‹æ€§æ ˆ**: ä¸‰æ”¯æŸ±ï¼ˆThree Pillarsï¼‰

---

## ğŸ“Š ç¬¬ä¸€éƒ¨åˆ†ï¼šGrafanaï¼ˆç»Ÿä¸€å¯è§†åŒ–å¹³å°ï¼‰

### ä¸ºä»€ä¹ˆä» Grafana å¼€å§‹ï¼Ÿ
- **é›†æˆæ‰€æœ‰æ•°æ®æº**ï¼šMetricsã€Logsã€Traces
- **æœ€ç›´è§‚**ï¼šå¯è§†åŒ–å›¾è¡¨å’Œä»ªè¡¨æ¿
- **ç”Ÿäº§çº§å·¥å…·**ï¼šä¼ä¸šå¹¿æ³›ä½¿ç”¨

### å­¦ä¹ æ­¥éª¤

#### 1. åŸºç¡€æ“ä½œ
- [ ] ç™»å½• Grafana (admin/admin)
- [ ] æµè§ˆé»˜è®¤ä»ªè¡¨æ¿
- [ ] ç†è§£æ•°æ®æºï¼ˆData Sourcesï¼‰æ¦‚å¿µ

#### 2. æŸ¥çœ‹é¢„ç½®ä»ªè¡¨æ¿
- [ ] **Kubernetes / Compute Resources / Cluster**
  - æŸ¥çœ‹é›†ç¾¤èµ„æºä½¿ç”¨æƒ…å†µ
  - CPUã€å†…å­˜ã€ç½‘ç»œæŒ‡æ ‡
  
- [ ] **Kubernetes / Compute Resources / Namespace (Pods)**
  - æŸ¥çœ‹ Pod çº§åˆ«çš„èµ„æºä½¿ç”¨
  - æ‰¾åˆ°ä½ çš„å¾®æœåŠ¡ Pod

- [ ] **Kubernetes / Compute Resources / Pod**
  - æ·±å…¥æŸ¥çœ‹å•ä¸ª Pod çš„æŒ‡æ ‡

#### 3. åˆ›å»ºè‡ªå®šä¹‰ä»ªè¡¨æ¿
- [ ] åˆ›å»ºæ–°ä»ªè¡¨æ¿
- [ ] æ·»åŠ é¢æ¿ï¼ˆPanelï¼‰
- [ ] é€‰æ‹©æŒ‡æ ‡ï¼ˆMetricsï¼‰
- [ ] è®¾ç½®æ—¶é—´èŒƒå›´

#### 4. å…³é”®æ¦‚å¿µ
- **Dashboardï¼ˆä»ªè¡¨æ¿ï¼‰**: å¤šä¸ªå›¾è¡¨çš„é›†åˆ
- **Panelï¼ˆé¢æ¿ï¼‰**: å•ä¸ªå›¾è¡¨
- **Queryï¼ˆæŸ¥è¯¢ï¼‰**: PromQL æŸ¥è¯¢è¯­å¥
- **Alertï¼ˆå‘Šè­¦ï¼‰**: åŸºäºæŒ‡æ ‡çš„å‘Šè­¦è§„åˆ™

### å®è·µä»»åŠ¡
1. æ‰¾åˆ°ä½ çš„å¾®æœåŠ¡ï¼ˆuser-service, product-service, order-serviceï¼‰çš„æŒ‡æ ‡
2. åˆ›å»ºä¸€ä¸ªæ˜¾ç¤ºæ‰€æœ‰å¾®æœåŠ¡ CPU ä½¿ç”¨ç‡çš„ä»ªè¡¨æ¿
3. è®¾ç½®ä¸€ä¸ªå‘Šè­¦ï¼šå½“ Pod CPU > 80% æ—¶é€šçŸ¥

---

## ğŸ“ˆ ç¬¬äºŒéƒ¨åˆ†ï¼šPrometheusï¼ˆæŒ‡æ ‡æŸ¥è¯¢å¼•æ“ï¼‰

### ä¸ºä»€ä¹ˆå­¦ä¹  Prometheusï¼Ÿ
- **æ ‡å‡†å·¥å…·**ï¼šKubernetes ç”Ÿæ€ç³»ç»Ÿçš„æ ‡å‡†
- **å¼ºå¤§çš„æŸ¥è¯¢è¯­è¨€**ï¼šPromQL
- **æ•°æ®æº**ï¼šGrafana çš„æ•°æ®æ¥æº

### å­¦ä¹ æ­¥éª¤

#### 1. åŸºç¡€æŸ¥è¯¢
- [ ] è®¿é—® Prometheus UI (http://localhost:9090)
- [ ] ç†è§£ **Graph** å’Œ **Console** è§†å›¾
- [ ] æŸ¥çœ‹å¯ç”¨æŒ‡æ ‡åˆ—è¡¨

#### 2. PromQL åŸºç¡€è¯­æ³•

**å…³é”®æ¦‚å¿µï¼š**
- **Metricï¼ˆæŒ‡æ ‡ï¼‰**: å¦‚ `http_requests_total`
- **Labelï¼ˆæ ‡ç­¾ï¼‰**: å¦‚ `{service="user-service"}`
- **Time Seriesï¼ˆæ—¶é—´åºåˆ—ï¼‰**: æŒ‡æ ‡ + æ ‡ç­¾çš„ç»„åˆ

**å¸¸ç”¨æŸ¥è¯¢ï¼š**
```promql
# æŸ¥çœ‹æ‰€æœ‰ HTTP è¯·æ±‚æ€»æ•°
http_requests_total

# æŒ‰æœåŠ¡è¿‡æ»¤
http_requests_total{service="user-service"}

# è®¡ç®—é€Ÿç‡ï¼ˆæ¯ç§’è¯·æ±‚æ•°ï¼‰
rate(http_requests_total[5m])

# è®¡ç®—å¹³å‡å€¼
avg(cpu_usage)

# èšåˆå‡½æ•°
sum(http_requests_total) by (service)
```

#### 3. å®ç”¨æŸ¥è¯¢ç¤ºä¾‹

**å¾®æœåŠ¡ç›¸å…³ï¼š**
```promql
# æŸ¥çœ‹å¾®æœåŠ¡çš„ HTTP è¯·æ±‚é€Ÿç‡
rate(http_requests_total{namespace="microservices"}[5m])

# æŸ¥çœ‹ Pod CPU ä½¿ç”¨ç‡
container_cpu_usage_seconds_total{namespace="microservices"}

# æŸ¥çœ‹ Pod å†…å­˜ä½¿ç”¨
container_memory_usage_bytes{namespace="microservices"}
```

**Kubernetes ç›¸å…³ï¼š**
```promql
# æŸ¥çœ‹æ‰€æœ‰ Pod çŠ¶æ€
kube_pod_status_phase

# æŸ¥çœ‹èŠ‚ç‚¹èµ„æº
node_cpu_seconds_total
node_memory_MemTotal_bytes
```

#### 4. é«˜çº§åŠŸèƒ½
- [ ] **Alertsï¼ˆå‘Šè­¦ï¼‰**: æŸ¥çœ‹å‘Šè­¦è§„åˆ™
- [ ] **Targetsï¼ˆç›®æ ‡ï¼‰**: æŸ¥çœ‹ç›‘æ§ç›®æ ‡çŠ¶æ€
- [ ] **Service Discovery**: äº†è§£è‡ªåŠ¨å‘ç°æœºåˆ¶

### å®è·µä»»åŠ¡
1. æŸ¥è¯¢ä½ çš„å¾®æœåŠ¡çš„è¯·æ±‚é€Ÿç‡
2. æ‰¾å‡º CPU ä½¿ç”¨ç‡æœ€é«˜çš„ Pod
3. åˆ›å»ºä¸€ä¸ªæŸ¥è¯¢æ˜¾ç¤ºæ‰€æœ‰å¾®æœåŠ¡çš„é”™è¯¯ç‡

---

## ğŸ” ç¬¬ä¸‰éƒ¨åˆ†ï¼šJaegerï¼ˆåˆ†å¸ƒå¼è¿½è¸ªï¼‰

### ä¸ºä»€ä¹ˆå­¦ä¹  Jaegerï¼Ÿ
- **ç†è§£è¯·æ±‚æµç¨‹**ï¼šçœ‹åˆ°è¯·æ±‚å¦‚ä½•åœ¨å¾®æœåŠ¡é—´æµè½¬
- **æ€§èƒ½åˆ†æ**ï¼šæ‰¾å‡ºæ…¢è¯·æ±‚å’Œç“¶é¢ˆ
- **è°ƒè¯•å·¥å…·**ï¼šè¿½è¸ªé”™è¯¯å’Œå¼‚å¸¸

### å­¦ä¹ æ­¥éª¤

#### 1. åŸºç¡€æ¦‚å¿µ
- **Traceï¼ˆè¿½è¸ªï¼‰**: ä¸€æ¬¡å®Œæ•´çš„è¯·æ±‚é“¾è·¯
- **Spanï¼ˆè·¨åº¦ï¼‰**: è¿½è¸ªä¸­çš„ä¸€ä¸ªæ“ä½œ
- **Serviceï¼ˆæœåŠ¡ï¼‰**: ä½ çš„å¾®æœåŠ¡
- **Operationï¼ˆæ“ä½œï¼‰**: API ç«¯ç‚¹

#### 2. ç”Ÿæˆè¿½è¸ªæ•°æ®
é¦–å…ˆéœ€è¦ç”Ÿæˆä¸€äº›è¿½è¸ªæ•°æ®ï¼š

**æ–¹æ³• 1ï¼šé€šè¿‡ API è°ƒç”¨**
```powershell
# åœ¨å¦ä¸€ä¸ªç»ˆç«¯è¿è¡Œ
kubectl port-forward -n microservices svc/user-service 8001:8001

# ç„¶åè®¿é—®
http://localhost:8001/docs
# è°ƒç”¨ä¸€äº› API ç«¯ç‚¹
```

**æ–¹æ³• 2ï¼šä½¿ç”¨æµ‹è¯•è„šæœ¬**
```powershell
.\scripts\test-all-services.ps1
```

#### 3. åœ¨ Jaeger ä¸­æŸ¥çœ‹è¿½è¸ª

**æ“ä½œæ­¥éª¤ï¼š**
1. æ‰“å¼€ Jaeger UI (http://localhost:16686)
2. é€‰æ‹© **Service**: `user-service` æˆ– `order-service`
3. ç‚¹å‡» **Find Traces**
4. æŸ¥çœ‹è¿½è¸ªåˆ—è¡¨

#### 4. ç†è§£è¿½è¸ªè§†å›¾

**Trace Timelineï¼ˆæ—¶é—´çº¿è§†å›¾ï¼‰:**
- çœ‹åˆ°è¯·æ±‚çš„å®Œæ•´è·¯å¾„
- æ¯ä¸ª Span çš„æŒç»­æ—¶é—´
- æœåŠ¡é—´çš„è°ƒç”¨å…³ç³»

**Trace Graphï¼ˆå›¾å½¢è§†å›¾ï¼‰:**
- å¯è§†åŒ–æœåŠ¡è°ƒç”¨å…³ç³»
- çœ‹åˆ°æ•°æ®æµå‘

**Span Detailsï¼ˆè¯¦ç»†ä¿¡æ¯ï¼‰:**
- Tagsï¼ˆæ ‡ç­¾ï¼‰: è¯·æ±‚çš„å…ƒæ•°æ®
- Logsï¼ˆæ—¥å¿—ï¼‰: æ“ä½œæ—¥å¿—
- Processï¼ˆè¿›ç¨‹ï¼‰: æœåŠ¡ä¿¡æ¯

#### 5. å…³é”®æŒ‡æ ‡
- **Durationï¼ˆæŒç»­æ—¶é—´ï¼‰**: è¯·æ±‚æ€»è€—æ—¶
- **Spansï¼ˆè·¨åº¦æ•°ï¼‰**: åŒ…å«çš„æ“ä½œæ•°
- **Errorsï¼ˆé”™è¯¯ï¼‰**: æ˜¯å¦æœ‰é”™è¯¯

### å®è·µä»»åŠ¡
1. åˆ›å»ºä¸€ä¸ªç”¨æˆ·ï¼ˆé€šè¿‡ user-serviceï¼‰
2. åˆ›å»ºä¸€ä¸ªè®¢å•ï¼ˆé€šè¿‡ order-serviceï¼Œä¼šè°ƒç”¨ user-service å’Œ product-serviceï¼‰
3. åœ¨ Jaeger ä¸­æ‰¾åˆ°è¿™ä¸ªè®¢å•çš„å®Œæ•´è¿½è¸ª
4. åˆ†æå“ªä¸ªæœåŠ¡æœ€æ…¢

---

## ğŸ”— ç¬¬å››éƒ¨åˆ†ï¼šæ•´åˆå­¦ä¹ ï¼ˆä¸‰æ”¯æŸ±ç»“åˆï¼‰

### å­¦ä¹ ç›®æ ‡
ç†è§£å¦‚ä½•å°† Metricsã€Logsã€Traces ç»“åˆä½¿ç”¨

### å®è·µåœºæ™¯

#### åœºæ™¯ 1ï¼šæ€§èƒ½é—®é¢˜æ’æŸ¥
1. **Grafana**: å‘ç° CPU ä½¿ç”¨ç‡çªç„¶å‡é«˜
2. **Prometheus**: æŸ¥è¯¢å…·ä½“æ˜¯å“ªä¸ª Pod
3. **Jaeger**: æŸ¥çœ‹è¯¥æœåŠ¡çš„è¯·æ±‚è¿½è¸ªï¼Œæ‰¾å‡ºæ…¢è¯·æ±‚
4. **Grafana Logs**: æŸ¥çœ‹ç›¸å…³æ—¥å¿—

#### åœºæ™¯ 2ï¼šé”™è¯¯æ’æŸ¥
1. **Grafana**: çœ‹åˆ°é”™è¯¯ç‡ä¸Šå‡
2. **Jaeger**: æ‰¾åˆ°å¤±è´¥çš„è¿½è¸ª
3. **Grafana Logs**: æŸ¥çœ‹é”™è¯¯æ—¥å¿—è¯¦æƒ…
4. **Prometheus**: åˆ†æé”™è¯¯æ¨¡å¼

#### åœºæ™¯ 3ï¼šå®¹é‡è§„åˆ’
1. **Prometheus**: æŸ¥è¯¢å†å²æŒ‡æ ‡æ•°æ®
2. **Grafana**: å¯è§†åŒ–è¶‹åŠ¿
3. é¢„æµ‹æœªæ¥èµ„æºéœ€æ±‚

---

## ğŸ“ å…³é”®æ¦‚å¿µé€ŸæŸ¥

### Metricsï¼ˆæŒ‡æ ‡ï¼‰
- **Counterï¼ˆè®¡æ•°å™¨ï¼‰**: åªå¢ä¸å‡ï¼Œå¦‚è¯·æ±‚æ€»æ•°
- **Gaugeï¼ˆä»ªè¡¨ï¼‰**: å¯å¢å¯å‡ï¼Œå¦‚ CPU ä½¿ç”¨ç‡
- **Histogramï¼ˆç›´æ–¹å›¾ï¼‰**: åˆ†å¸ƒç»Ÿè®¡ï¼Œå¦‚å“åº”æ—¶é—´åˆ†å¸ƒ
- **Summaryï¼ˆæ‘˜è¦ï¼‰**: ç±»ä¼¼ Histogramï¼Œä½†åŒ…å«ç™¾åˆ†ä½æ•°

### Logsï¼ˆæ—¥å¿—ï¼‰
- **ç»“æ„åŒ–æ—¥å¿—**: JSON æ ¼å¼
- **æ—¥å¿—çº§åˆ«**: DEBUG, INFO, WARN, ERROR
- **æ—¥å¿—èšåˆ**: Loki æ”¶é›†å’Œå­˜å‚¨
- **æ—¥å¿—æŸ¥è¯¢**: LogQLï¼ˆç±»ä¼¼ PromQLï¼‰

### Tracesï¼ˆè¿½è¸ªï¼‰
- **é‡‡æ ·ç‡**: ä¸æ˜¯æ‰€æœ‰è¯·æ±‚éƒ½è¿½è¸ª
- **ä¸Šä¸‹æ–‡ä¼ æ’­**: TraceID åœ¨æœåŠ¡é—´ä¼ é€’
- **Span ç±»å‹**: Client, Server, Internal
- **Baggage**: åœ¨è¿½è¸ªä¸­ä¼ é€’è‡ªå®šä¹‰æ•°æ®

---

## ğŸ“ å­¦ä¹ è·¯å¾„å»ºè®®

### ç¬¬ 1 å‘¨ï¼šåŸºç¡€
- [ ] ç†Ÿæ‚‰ Grafana ç•Œé¢å’ŒåŸºæœ¬æ“ä½œ
- [ ] ç†è§£ Prometheus åŸºæœ¬æŸ¥è¯¢
- [ ] åœ¨ Jaeger ä¸­æŸ¥çœ‹ç®€å•è¿½è¸ª

### ç¬¬ 2 å‘¨ï¼šè¿›é˜¶
- [ ] åˆ›å»ºè‡ªå®šä¹‰ Grafana ä»ªè¡¨æ¿
- [ ] æŒæ¡ PromQL å¸¸ç”¨æŸ¥è¯¢
- [ ] åˆ†æå¤æ‚çš„åˆ†å¸ƒå¼è¿½è¸ª

### ç¬¬ 3 å‘¨ï¼šå®æˆ˜
- [ ] è®¾ç½®å‘Šè­¦è§„åˆ™
- [ ] æ’æŸ¥å®é™…æ€§èƒ½é—®é¢˜
- [ ] ä¼˜åŒ–å¾®æœåŠ¡æ€§èƒ½

### ç¬¬ 4 å‘¨ï¼šæ·±å…¥
- [ ] ç†è§£ OpenTelemetry æ ‡å‡†
- [ ] è‡ªå®šä¹‰æŒ‡æ ‡å’Œè¿½è¸ª
- [ ] ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ

---

## ğŸ”§ å®ç”¨å‘½ä»¤é€ŸæŸ¥

### Grafana
```powershell
# è®¿é—® Grafana
kubectl port-forward -n monitoring svc/prometheus-operator-grafana 3000:80
# http://localhost:3000 (admin/admin)
```

### Prometheus
```powershell
# è®¿é—® Prometheus
kubectl port-forward -n monitoring prometheus-prometheus-operator-kube-p-prometheus-0 9090:9090
# http://localhost:9090
```

### Jaeger
```powershell
# è®¿é—® Jaeger
$pod = kubectl get pod -n observability -l app.kubernetes.io/name=jaeger,app.kubernetes.io/component=query -o jsonpath='{.items[0].metadata.name}'
kubectl port-forward -n observability $pod 16686:16686
# http://localhost:16686
```

---

## ğŸ“š æ¨èå­¦ä¹ èµ„æº

### å®˜æ–¹æ–‡æ¡£
- [Grafana Documentation](https://grafana.com/docs/)
- [Prometheus Documentation](https://prometheus.io/docs/)
- [Jaeger Documentation](https://www.jaegertracing.io/docs/)

### PromQL å­¦ä¹ 
- [PromQL Basics](https://prometheus.io/docs/prometheus/latest/querying/basics/)
- [PromQL Functions](https://prometheus.io/docs/prometheus/latest/querying/functions/)

### å®è·µé¡¹ç›®
- åˆ›å»ºè‡ªå·±çš„ä»ªè¡¨æ¿
- è®¾ç½®å‘Šè­¦è§„åˆ™
- åˆ†æçœŸå®è¯·æ±‚è¿½è¸ª

---

## âœ… å­¦ä¹ æ£€æŸ¥æ¸…å•

### åŸºç¡€æŒæ¡
- [ ] èƒ½åœ¨ Grafana ä¸­æŸ¥çœ‹æŒ‡æ ‡
- [ ] èƒ½åœ¨ Prometheus ä¸­æ‰§è¡ŒåŸºæœ¬æŸ¥è¯¢
- [ ] èƒ½åœ¨ Jaeger ä¸­æ‰¾åˆ°è¿½è¸ª

### è¿›é˜¶èƒ½åŠ›
- [ ] èƒ½åˆ›å»ºè‡ªå®šä¹‰ä»ªè¡¨æ¿
- [ ] èƒ½ç¼–å†™ PromQL æŸ¥è¯¢
- [ ] èƒ½åˆ†æåˆ†å¸ƒå¼è¿½è¸ª

### å®æˆ˜èƒ½åŠ›
- [ ] èƒ½æ’æŸ¥æ€§èƒ½é—®é¢˜
- [ ] èƒ½è®¾ç½®å‘Šè­¦
- [ ] èƒ½ä¼˜åŒ–ç³»ç»Ÿæ€§èƒ½

---

## ğŸ¯ ä¸‹ä¸€æ­¥

1. **ç°åœ¨å°±å¼€å§‹**ï¼šæ‰“å¼€ Grafanaï¼Œæµè§ˆé¢„ç½®ä»ªè¡¨æ¿
2. **ç”Ÿæˆæ•°æ®**ï¼šè°ƒç”¨ä½ çš„å¾®æœåŠ¡ APIï¼Œç”Ÿæˆè¿½è¸ªæ•°æ®
3. **å®è·µæŸ¥è¯¢**ï¼šåœ¨ Prometheus ä¸­å°è¯•ä¸åŒçš„æŸ¥è¯¢
4. **åˆ†æè¿½è¸ª**ï¼šåœ¨ Jaeger ä¸­æŸ¥çœ‹å®Œæ•´çš„è¯·æ±‚é“¾è·¯

**è®°ä½**ï¼šå¯è§‚æµ‹æ€§æ˜¯ä¸€ä¸ªå®è·µæ€§å¾ˆå¼ºçš„æŠ€èƒ½ï¼Œå¤šåŠ¨æ‰‹æ“ä½œæ¯”åªçœ‹æ–‡æ¡£æ›´æœ‰æ•ˆï¼




