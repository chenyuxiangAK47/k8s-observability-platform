# äº‘åŸç”Ÿå¯è§‚æµ‹æ€§å¹³å° - Kubernetesç‰ˆæœ¬

è¿™æ˜¯ä¸€ä¸ªå°† `production-ready-observability-platform` å’Œ `microshop-microservices` æ•´åˆå¹¶è¿ç§»åˆ° Kubernetes çš„å®Œæ•´é¡¹ç›®ã€‚

## ğŸ¯ é¡¹ç›®äº®ç‚¹

1. **ğŸš€ ä¼ä¸šçº§ GitOps + CI/CD**ï¼šå®Œæ•´çš„è‡ªåŠ¨åŒ–éƒ¨ç½²æµç¨‹ï¼Œä»ä»£ç æäº¤åˆ°ç”Ÿäº§éƒ¨ç½²å…¨è‡ªåŠ¨ï¼ˆLint â†’ Build â†’ Test â†’ Scan â†’ Deployï¼‰
2. **ğŸ“¦ ArgoCD GitOps éƒ¨ç½²**ï¼šå£°æ˜å¼éƒ¨ç½²ï¼Œå¯å®¡è®¡ã€å¯å›æ»šï¼ŒGit æ˜¯å”¯ä¸€çœŸå®æ¥æº
3. **ğŸ” Prometheus Operator è‡ªåŠ¨å‘ç°**ï¼šé€šè¿‡ ServiceMonitor å®ç°é›¶é…ç½®æŒ‡æ ‡é‡‡é›†ï¼Œæ— éœ€æ‰‹åŠ¨é…ç½® Prometheus scrape_configs
4. **ğŸ”— OpenTelemetry åˆ†å¸ƒå¼è¿½è¸ª**ï¼šå®Œæ•´çš„ Trace é“¾è·¯ï¼Œæ”¯æŒè·¨æœåŠ¡è¿½è¸ªï¼Œè‡ªåŠ¨æ£€æµ‹ FastAPI å’Œ SQLAlchemy
5. **ğŸ“ˆ HPA è‡ªåŠ¨æ‰©ç¼©å®¹**ï¼šåŸºäº CPU/å†…å­˜æŒ‡æ ‡è‡ªåŠ¨è°ƒæ•´ Pod æ•°é‡ï¼Œå®ç°å¼¹æ€§ä¼¸ç¼©
6. **ğŸ“‹ Helm Chart æ¨¡å—åŒ–**ï¼šå¯å¤ç”¨çš„ Chart è®¾è®¡ï¼Œæ”¯æŒå¤šç¯å¢ƒéƒ¨ç½²ï¼Œé…ç½®ä¸ä»£ç åˆ†ç¦»
7. **ğŸ› ï¸ é—®é¢˜æ’æŸ¥å®æˆ˜**ï¼šè§£å†³äº† Prometheus æŒ‡æ ‡é‡å¤æ³¨å†Œã€ServiceMonitor é…ç½®åŒ¹é…ã€API å®šä¹‰ç­‰å®é™…é—®é¢˜ï¼Œæ‰€æœ‰é—®é¢˜éƒ½æœ‰è¯¦ç»†çš„æ’æŸ¥æ–‡æ¡£
8. **ğŸ“Š å®Œæ•´çš„ä¸‰æ”¯æŸ±å¯è§‚æµ‹æ€§**ï¼šMetricsï¼ˆPrometheusï¼‰+ Logsï¼ˆLokiï¼‰+ Tracesï¼ˆJaegerï¼‰ï¼Œç»Ÿä¸€åœ¨ Grafana ä¸­å¯è§†åŒ–
9. **âœ… CI/CD è‡ªåŠ¨åŒ–**ï¼šGitHub Actions è‡ªåŠ¨éªŒè¯ã€æ„å»ºã€æµ‹è¯•ã€æ‰«æå’Œéƒ¨ç½²

## ğŸ¯ é¡¹ç›®ç›®æ ‡

1. âœ… å°†å¯è§‚æµ‹æ€§å¹³å°è¿ç§»åˆ° Kubernetes
2. âœ… ä½¿ç”¨ Helm Chart ç®¡ç†æ‰€æœ‰ç»„ä»¶
3. âœ… é›†æˆ Prometheus Operator
4. âœ… æ·»åŠ  HPA è‡ªåŠ¨æ‰©ç¼©å®¹
5. âœ… é›†æˆå¾®æœåŠ¡ï¼ˆuser-serviceã€product-serviceã€order-serviceï¼‰
6. âœ… å®ç°å®Œæ•´çš„ OpenTelemetry è¿½è¸ª
7. âœ… å®ç° CI/CD è‡ªåŠ¨åŒ–æµç¨‹ï¼ˆGitHub Actionsï¼‰
8. âœ… **å®ç° GitOps éƒ¨ç½²ï¼ˆArgoCDï¼‰**
9. âœ… **å®Œæ•´çš„ä¼ä¸šçº§ CI/CD Pipelineï¼ˆLint â†’ Build â†’ Test â†’ Scan â†’ Deployï¼‰**

## ğŸ“¦ é¡¹ç›®ç»“æ„

```
.
â”œâ”€â”€ services/                      # å¾®æœåŠ¡æºä»£ç ï¼ˆåŒ…å« OpenTelemetryï¼‰
â”‚   â”œâ”€â”€ user-service/
â”‚   â”œâ”€â”€ product-service/
â”‚   â””â”€â”€ order-service/
â”œâ”€â”€ helm/                          # Helm Charts
â”‚   â”œâ”€â”€ observability-platform/   # å¯è§‚æµ‹æ€§å¹³å°Chart
â”‚   â””â”€â”€ microservices/             # å¾®æœåŠ¡Chart
â”œâ”€â”€ k8s/                           # Kubernetes åŸç”Ÿé…ç½®
â”‚   â”œâ”€â”€ namespaces/                # å‘½åç©ºé—´é…ç½®
â”‚   â”œâ”€â”€ monitoring/                 # ç›‘æ§ç›¸å…³é…ç½®
â”‚   â”œâ”€â”€ services/                  # å¾®æœåŠ¡éƒ¨ç½²é…ç½®
â”‚   â””â”€â”€ ingress/                   # Ingressé…ç½®
â”œâ”€â”€ scripts/                       # æ„å»ºå’Œéƒ¨ç½²è„šæœ¬
â”‚   â”œâ”€â”€ build-images.sh/.ps1      # æ„å»ºé•œåƒè„šæœ¬
â”‚   â”œâ”€â”€ setup-and-deploy.sh/.ps1  # å®Œæ•´éƒ¨ç½²è„šæœ¬
â”‚   â”œâ”€â”€ install-argocd.sh/.ps1    # å®‰è£… ArgoCD è„šæœ¬
â”‚   â””â”€â”€ deploy-gitops.sh/.ps1     # éƒ¨ç½² GitOps åº”ç”¨è„šæœ¬
â”œâ”€â”€ gitops/                        # GitOps é…ç½®
â”‚   â”œâ”€â”€ apps/                      # ArgoCD Application é…ç½®
â”‚   â”‚   â”œâ”€â”€ microservices-app.yaml
â”‚   â”‚   â””â”€â”€ observability-app.yaml
â”‚   â””â”€â”€ README.md                  # GitOps è¯´æ˜æ–‡æ¡£
â””â”€â”€ docs/                          # æ–‡æ¡£
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚

- Docker Desktop è¿è¡Œä¸­
- kubectl å·²å®‰è£…
- Helm 3.x å·²å®‰è£…
- kind å·²å®‰è£…ï¼ˆç”¨äºæœ¬åœ°é›†ç¾¤ï¼‰

### ä¸€é”®éƒ¨ç½²

#### Windows (PowerShell)

```powershell
# å®Œæ•´è®¾ç½®å’Œéƒ¨ç½²ï¼ˆåŒ…æ‹¬æ„å»ºé•œåƒï¼‰
.\scripts\setup-and-deploy.ps1
```

#### Linux/Mac (Bash)

```bash
# æ·»åŠ æ‰§è¡Œæƒé™
chmod +x scripts/*.sh

# å®Œæ•´è®¾ç½®å’Œéƒ¨ç½²
./scripts/setup-and-deploy.sh
```

### åˆ†æ­¥éƒ¨ç½²

#### 1. æ„å»º Docker é•œåƒ

```bash
# Windows
.\scripts\build-images.ps1

# Linux/Mac
./scripts/build-images.sh
```

#### 2. åˆ›å»º Kubernetes é›†ç¾¤

```bash
kind create cluster --name observability-platform
```

#### 3. éƒ¨ç½²æ‰€æœ‰ç»„ä»¶

```bash
# Windows
.\scripts\deploy.sh

# Linux/Mac
./scripts/deploy.sh
```

è¯¦ç»†æ­¥éª¤è¯·æŸ¥çœ‹ï¼š
- [NEXT_STEPS.md](NEXT_STEPS.md) - **ç«‹å³å¼€å§‹ï¼šä¸‹ä¸€æ­¥è¡ŒåŠ¨æŒ‡å—** â­
- [BUILD_AND_DEPLOY.md](BUILD_AND_DEPLOY.md) - æ„å»ºå’Œéƒ¨ç½²è¯¦è§£
- [docs/GITOPS_DEPLOYMENT.md](docs/GITOPS_DEPLOYMENT.md) - **GitOps + CI/CD å®Œæ•´éƒ¨ç½²æŒ‡å—** â­ **æ–°å¢**
- [LEARNING_NOTES.md](LEARNING_NOTES.md) - å­¦ä¹ ç¬”è®°ï¼ˆä¸ºä»€ä¹ˆè¿™ä¹ˆåšï¼‰

### GitOps å¿«é€Ÿå¼€å§‹

```bash
# 1. å®‰è£… ArgoCD
./scripts/install-argocd.sh  # Linux/Mac
.\scripts\install-argocd.ps1  # Windows

# 2. éƒ¨ç½² GitOps Applications
./scripts/deploy-gitops.sh   # Linux/Mac
.\scripts\deploy-gitops.ps1  # Windows

# 3. è®¿é—® ArgoCD UI
kubectl port-forward svc/argocd-server -n argocd 8080:443
# æ‰“å¼€ https://localhost:8080
```

## ğŸ“Š æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Kubernetes Cluster                        â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  microservices namespace                           â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚    â”‚
â”‚  â”‚  â”‚   User   â”‚  â”‚ Product  â”‚  â”‚  Order   â”‚         â”‚    â”‚
â”‚  â”‚  â”‚ Service  â”‚  â”‚ Service  â”‚  â”‚ Service  â”‚         â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜         â”‚    â”‚
â”‚  â”‚       â”‚             â”‚             â”‚                 â”‚    â”‚
â”‚  â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚    â”‚
â”‚  â”‚                    â”‚                                 â”‚    â”‚
â”‚  â”‚            OpenTelemetry SDK                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                       â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  observability namespace                             â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚  â”‚
â”‚  â”‚  â”‚Prometheusâ”‚  â”‚   Loki   â”‚  â”‚  Jaeger  â”‚           â”‚  â”‚
â”‚  â”‚  â”‚ Operator â”‚  â”‚          â”‚  â”‚          â”‚           â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜           â”‚  â”‚
â”‚  â”‚       â”‚             â”‚             â”‚                   â”‚  â”‚
â”‚  â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚  â”‚
â”‚  â”‚                    â”‚                                   â”‚  â”‚
â”‚  â”‚                 Grafana                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                       â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
                  â”‚  Ingress  â”‚
                  â”‚  (Nginx)  â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ ç»„ä»¶è¯´æ˜

### å¾®æœåŠ¡
- **user-service**: ç”¨æˆ·ç®¡ç†æœåŠ¡ï¼ˆç«¯å£ 8001ï¼‰
- **product-service**: å•†å“ç®¡ç†æœåŠ¡ï¼ˆç«¯å£ 8002ï¼‰
- **order-service**: è®¢å•ç®¡ç†æœåŠ¡ï¼ˆç«¯å£ 8003ï¼‰

### å¯è§‚æµ‹æ€§ç»„ä»¶
- **Prometheus**: æŒ‡æ ‡é‡‡é›†å’Œå­˜å‚¨
- **Grafana Loki**: æ—¥å¿—èšåˆ
- **Jaeger**: åˆ†å¸ƒå¼è¿½è¸ª
- **Grafana**: ç»Ÿä¸€å¯è§†åŒ–å¹³å°

## ğŸ“ˆ ç›‘æ§å’Œå‘Šè­¦

- ServiceMonitor: è‡ªåŠ¨å‘ç°å’Œé‡‡é›†æŒ‡æ ‡
- PrometheusRule: å‘Šè­¦è§„åˆ™å®šä¹‰
- HPA: åŸºäºCPU/å†…å­˜çš„è‡ªåŠ¨æ‰©ç¼©å®¹

## ğŸ“ å­¦ä¹ è¦ç‚¹

### 1. Docker é•œåƒæ„å»º
- å¤šé˜¶æ®µæ„å»ºä¼˜åŒ–é•œåƒå¤§å°
- å¥åº·æ£€æŸ¥é…ç½®
- æœ€ä½³å®è·µ

### 2. OpenTelemetry é›†æˆ
- åˆ†å¸ƒå¼è¿½è¸ªé…ç½®
- è‡ªåŠ¨æ£€æµ‹ï¼ˆAuto-instrumentationï¼‰
- è‡ªå®šä¹‰ Span å’Œå±æ€§

### 3. Kubernetes éƒ¨ç½²
- Helm Chart ä½¿ç”¨
- æœåŠ¡å‘ç°
- è‡ªåŠ¨æ‰©ç¼©å®¹

### 4. CI/CD è‡ªåŠ¨åŒ–
- GitHub Actions å·¥ä½œæµé…ç½®
- è‡ªåŠ¨åŒ–éªŒè¯å’Œæµ‹è¯•
- æŒç»­é›†æˆæœ€ä½³å®è·µ

è¯¦ç»†å­¦ä¹ è¯´æ˜è¯·æŸ¥çœ‹ä»£ç ä¸­çš„æ³¨é‡Šå’Œ [BUILD_AND_DEPLOY.md](BUILD_AND_DEPLOY.md)

## ğŸ”„ CI/CD æµç¨‹

æœ¬é¡¹ç›®å®ç°äº†**ä¼ä¸šçº§ CI/CD Pipeline**ï¼ŒåŒ…å« 5 ä¸ªå®Œæ•´é˜¶æ®µï¼š

### å®Œæ•´ Pipeline æµç¨‹

```
ä»£ç æäº¤
    â†“
ğŸ” Lintï¼ˆä»£ç æ£€æŸ¥ï¼‰
    â”œâ”€ Kubernetes YAML éªŒè¯
    â”œâ”€ Helm Chart éªŒè¯
    â””â”€ Python ä»£ç æ£€æŸ¥
    â†“
ğŸ—ï¸ Buildï¼ˆæ„å»ºé•œåƒï¼‰
    â”œâ”€ å¹¶è¡Œæ„å»º 3 ä¸ªå¾®æœåŠ¡é•œåƒ
    â””â”€ æ¨é€åˆ° GitHub Container Registry (GHCR)
    â†“
ğŸ§ª Testï¼ˆè¿è¡Œæµ‹è¯•ï¼‰
    â”œâ”€ å¥åº·æ£€æŸ¥æµ‹è¯•
    â””â”€ å¯¼å…¥æµ‹è¯•
    â†“
ğŸ”’ Scanï¼ˆå®‰å…¨æ‰«æï¼‰
    â””â”€ Trivy æ¼æ´æ‰«æ
    â†“
ğŸš€ Deployï¼ˆGitOps éƒ¨ç½²ï¼‰
    â”œâ”€ æ›´æ–° Helm valuesï¼ˆé•œåƒæ ‡ç­¾ï¼‰
    â”œâ”€ æäº¤åˆ° Git
    â””â”€ ArgoCD è‡ªåŠ¨åŒæ­¥åˆ° Kubernetes
```

### Pipeline ç‰¹æ€§

- âœ… **å¤šé˜¶æ®µéªŒè¯**ï¼šLint â†’ Build â†’ Test â†’ Scan â†’ Deploy
- âœ… **å¹¶è¡Œæ„å»º**ï¼šä¸‰ä¸ªå¾®æœåŠ¡åŒæ—¶æ„å»ºï¼Œæé«˜æ•ˆç‡
- âœ… **å®‰å…¨æ‰«æ**ï¼šè‡ªåŠ¨æ‰«æ Docker é•œåƒæ¼æ´
- âœ… **GitOps é›†æˆ**ï¼šè‡ªåŠ¨æ›´æ–°é…ç½®å¹¶è§¦å‘ ArgoCD åŒæ­¥
- âœ… **é•œåƒç®¡ç†**ï¼šè‡ªåŠ¨æ¨é€åˆ° GHCRï¼Œæ”¯æŒå¤šæ ‡ç­¾ç­–ç•¥

è¯¦ç»†è¯´æ˜è¯·æŸ¥çœ‹ï¼š
- [CI/CD å­¦ä¹ æŒ‡å—](docs/CI_CD_GUIDE.md)
- [GitOps éƒ¨ç½²æŒ‡å—](docs/GITOPS_DEPLOYMENT.md) â­ **æ–°å¢**

## ğŸ”— ç›¸å…³é¡¹ç›®

- [production-ready-observability-platform](https://github.com/chenyuxiangAK47/production-ready-observability-platform)
- [microshop-microservices](https://github.com/chenyuxiangAK47/microshop-microservices)
- [Prometheus-Grafana](https://github.com/chenyuxiangAK47/Prometheus-Grafana)

## ğŸ“„ License

MIT License
